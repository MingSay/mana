{% extends "base.html" %}


{% block title %}free resource{% endblock %}


{% block style %}
<script type="text/javascript" src="/static/jquery.base64.js"></script>
{% endblock %}

{% block content %}

<div>
<ul>
 <li>
     <input type="text" id="base64En" value=""/>
     <input type="button" value=" >> base64.encode >> " onclick="encode64()"/>
     <input type="text" id="base64EnVal" value="" placeholder="base64 encode value"/>
 </li>
 <li>
     <input type="text" id="base64De" value=""/>
     <input type="button" value=" >> base64.decode >> " onclick="decode64()"/>
     <input type="text" id="base64DeVal" value="" placeholder="base64 decode value"/>
 </li>
 <li><a href="/api/free-res/" target="_blank">resource usage</a></li>
 <li><a href="/api/service-status/" target="_blank">service status</a></li>

 <!--
    <li><a href="/api/az-list/" target="_blank">az > compute nodes</a></li>
  -->

    {% for region in regions %}
    <li>
        <a href="/api/free-ip/{{ region }}/" target="_blank">Region({{ region }}) free ip show</a>
        &nbsp;||&nbsp; <a href="/api/virs/{{ region }}/" target="_blank">ceilometer({{ region }})</a>
    </li>
    {% endfor %}
 <li><a href="/api/free-ip-list/" target="_blank">free ip list</a></li>


 <li>ip查询:<input type="text" id="ipInfo" placeholder="IP"/> <input type="button" id="searchIp" value=" search " onclick="ipInfo()"/></li>


 <li>迁移机器ip:<input type="text" id="evaIp" value="" placeholder="IP"/>
     token校验:<input type="text" id="auth_token" value="" placeholder="TOKEN"/>

<select id="region">
    {% for region in regions %}
    <option value="{{ region }}">{{ region }}</option>
    {% endfor %}
</selct>

 <input type="button" id="searchIp" value=" 迁移 " onclick="showEvaLog()"/>
 </li>
 
 <li>
     自建内网:<input type="text" id="n_tenantid"  placeholder="tenant_id"/><input type="text" id="n_networkname"  placeholder="network_name"/>
     <input type="text" id="auth_token2" value="" placeholder="TOKEN"/>
     <select id="region2">
         {% for region in regions %}
         <option value="{{ region }}">{{ region }}</option>
         {% endfor %}
         </selct>
     <input type="button" id="createSelfNetwork" value=" 自建 " onclick="createNetwork()"/>
 </li>
 
 
</ul>
</div>
<div id="display2" class="darkbrown">
<div id="display" class="darkbrown">

</div>


<script type="text/javascript">

function ipInfo(){
   var ip=$("#ipInfo").val();
   var url="/api/machine/"+ip+"/";
   window.open(url);
}

function evacuate(){
   var ip=$("#evaIp").val();
   var url="/api/repair-eva/"+ip;
   window.open(url);
}

function showEvaLog(){

   var ips=$("#evaIp").val();

   ip_list=ips.split(/,|;|，|。|；|、| /);

   token=$("#auth_token").val();
   if(token.length<10){
        alert("未输入auth-token");
    return;
   }

   $("#display").empty();

   for(var i=0;i<ip_list.length;i++)
   {
    var url="/api/repair-eva/"+ip_list[i]+"/"+$("#region").val()+"/";
    var param = {};

       $.ajax({
        url:url,
        data:param,
        async:false,
        dataType:"html",
        beforeSend: function (request)
        {
            request.setRequestHeader("C2_AUTH_TOKEN",token);
        },
        success:function(result){
            var content="<div class='marY8'>----- evacute ip:( "+ip_list[i]+" ) ------</div>";
            content+="<div class='brown bold'>"+result+"</div>";
            content+="<div class='marY8'>-------------------------------------------</div><br><br>";
            $("#display").append(content);
        }
        });
   }

}

function createNetwork(){
    
    var n_tenantid=$("#n_tenantid").val();
    var n_networkname=$.base64.encode($("#n_networkname").val());
    
    token=$("#auth_token2").val();
    if(token.length<10){
        alert("未输入auth-token");
        return;
    }
    
    $("#display2").empty();
    
    var url="/api/get-token-network/"+$("#region2").val()+"/"+n_tenantid+"/"+n_networkname+"/";
    var param = {};
        
    $.ajax({
            url:url,
            data:param,
            async:false,
            dataType:"json",
            beforeSend: function (request)
            {
               request.setRequestHeader("C2_AUTH_TOKEN",token);
            },
            success:function(result){
               if(result.code==200)
               {
                alert("创建成功");
               }
               $("#display2").html(result.data);
            }
        });
}

function encode64()
{
    $("#base64EnVal").val($.base64.encode($("#base64En").val()));
}

function decode64()
{
    $("#base64DeVal").val($.base64.decode($("#base64De").val()));
}
</script>

{% endblock %}
