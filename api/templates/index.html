{% extends "base.html" %}


{% block title %}free resource{% endblock %}

{% block content %}

<div>
<ul>
 <li><a href="/api/free-res/" target="_blank">resource usage</a></li>
 <li><a href="/api/service-status/" target="_blank">service status</a></li>

 <!--
    <li><a href="/api/az-list/" target="_blank">az > compute nodes</a></li>
  -->

    {% for region in regions %}
    <li>
        <a href="/api/free-ip/{{ region }}/" target="_blank">Region({{ region }}) free ip show</a>
        &nbsp;||&nbsp; <a href="/api/virs/{{ region }}/" target="_blank">ceilometer({{ region }})</a>
    </li>
    {% endfor %}
 <li><a href="/api/free-ip-list/" target="_blank">free ip list</a></li>


 <li>search machine info by ip:<input type="text" id="ipInfo"/> <input type="button" id="searchIp" value=" search " onclick="ipInfo()"/></li>


 <li>evacuate machine by ip:<input type="text" id="evaIp" value=""/>
     input auth token:<input type="text" id="auth_token" value=""/>

<select id="region">
    {% for region in regions %}
    <option value="{{ region }}">{{ region }}</option>
    {% endfor %}
</selct>

 <input type="button" id="searchIp" value=" evacuate " onclick="showEvaLog()"/>
 </li>

</ul>
</div>

<div id="display" class="darkbrown">

</div>


<script type="text/javascript">

function ipInfo(){
   var ip=$("#ipInfo").val();
   var url="/api/machine/"+ip+"/";
   window.open(url);
}

function evacuate(){
   var ip=$("#evaIp").val();
   var url="/api/repair-eva/"+ip;
   window.open(url);
}

function showEvaLog(){

   var ips=$("#evaIp").val();

   ip_list=ips.split(/,|;|，|。|；|、| /);

   token=$("#auth_token").val();
   if(token.length<10){
        alert("未输入auth-token");
    return;
   }

   $("#display").empty();

   for(var i=0;i<ip_list.length;i++)
   {
    var url="/api/repair-eva/"+ip_list[i]+"/"+$("#region").val()+"/";
    var param = {};

       $.ajax({
        url:url,
        data:param,
        async:false,
        dataType:"html",
        beforeSend: function (request)
        {
            request.setRequestHeader("C2_AUTH_TOKEN",token);
        },
        success:function(result){
            var content="<div class='marY8'>----- evacute ip:( "+ip_list[i]+" ) ------</div>";
            content+="<div class='brown bold'>"+result+"</div>";
            content+="<div class='marY8'>-------------------------------------------</div><br><br>";
            $("#display").append(content);
        }
        });
   }

}





</script>

{% endblock %}
